#!/usr/bin/env murex

set project=github.com/lmorg/murex
set build_path=build-tests

cd $GOPATH/src/$project/test

mkdir $build_path
cd $build_path

set json targets = ([
    "linux",
    "freebsd",
    "darwin",
    "plan9",
    "windows"
])

let status=0

$targets -> foreach target {
    try {
        ({BLUE}Building $target....{RESET})
        export GOOS=$target
        go build $project
        out "{GREEN}SUCCESSFUL{RESET}"
    }
    catch {
        out "{RED}FAILED{RESET}"
	    let status++
    }
}

cd ..

try {
    ({BLUE}Building js/wasm....{RESET})
    export GOOS=js
    export GOARCH=wasm
    go build -o murex.wasm ../
}
catch {
    out "{RED}FAILED{RESET}"
    let status++
}

rm -rf $build_path

exit $status
